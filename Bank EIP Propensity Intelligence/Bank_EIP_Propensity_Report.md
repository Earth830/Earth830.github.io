# รายงานประเมินโมเดล (Validation) — Bank EIP Propensity Intelligence

> แหล่งที่มา: `Bank_Prod.ipynb`  
> วัตถุประสงค์: ยืนยันสมรรถนะโมเดลทำนายความน่าจะเป็นการตอบรับของลูกค้า (propensity) ภายใต้ **KPI Gate** ที่กำหนด เพื่อใช้คัดเลือกลูกค้าแบบ **Top‑K targeting** สำหรับแคมเปญการตลาด

---

## สรุป KPI (Validation)

| ตัวชี้วัด | ค่า (Validation) | เกณฑ์ผ่าน |
|---|---:|:---|
| **ROC‑AUC** | **0.6087** | ≥ 0.60 |
| **PR‑AUC (Average Precision)** | **0.4404** | ≥ 0.20 |
| **Precision@Top‑5%** | **0.5000** | ≥ 0.30 |
| **Lift@Top‑5%** | **1.38** | — |
| **ECE (Expected Calibration Error)** | **0.0200** | ≤ 0.02 |

**ผลการตัดสิน:** ✅ *ผ่านเกณฑ์* — บันทึกอาร์ติแฟกต์เรียบร้อย (`propensity_pipeline_*.joblib`, `model_card_*.json`, `gate_summary_*.json`).

> **ความหมายโดยสรุป**  
> - ROC‑AUC ~0.61: โมเดลแยกแยะผู้ตอบรับ/ไม่ตอบรับได้ดีกว่าเส้นสุ่มพอสมควรในทุก threshold  
> - PR‑AUC ~0.44: ประสิทธิภาพในกรณีข้อมูลไม่สมดุล (positive น้อย) อยู่ในระดับใช้งานได้  
> - Precision@5% = 50%: หากติดต่อเฉพาะ **ลูกค้า 5% แรก** ตามคะแนนโมเดล คาดว่า **1 ใน 2** จะตอบรับจริง (ขึ้นกับคอนเทนต์แคมเปญ)  
> - ECE = 0.020: ความน่าเชื่อถือของความน่าจะเป็นอยู่ในขอบเกณฑ์ — คะแนน ~0.40 หมายถึงโอกาสเกิดจริงใกล้ 40%

---

## กราฟและคำอธิบาย

**รูปที่ 1. KPI Gate & Artifact Log**  
![](/mnt/data/affcc1f8-867a-4549-862c-48e0b186b527.png)
โมดูล Gate สรุปเมตริก เทียบกับเกณฑ์ และบันทึกไฟล์อาร์ติแฟกต์เพื่อใช้งานจริง/รีโปรดิวซ์

**รูปที่ 2. ROC Curve (AUC ≈ 0.612)**  
![](/mnt/data/4d422609-50d2-4173-b650-9e676fe5f331.png)
เส้น ROC สูงกว่าบริเวณเส้นทแยง (สุ่ม) ตลอดช่วง แปลว่า **อัตราตรวจจับถูก (TPR)** เพิ่มขึ้นเร็วกว่าการเพิ่ม **อัตราเตือนผิด (FPR)** โดยรวม

**รูปที่ 3. Precision–Recall (AP ≈ 0.462)**  
![](/mnt/data/6900ebd2-1364-45a4-ad4f-53b9e5c9db07.png)
ในบริบทแคมเปญที่ Positive มีสัดส่วนต่ำ **PR‑Curve** ให้ภาพที่เหมาะกว่า ROC; พื้นที่ใต้โค้ง (AP) ~0.46 สะท้อนว่าเมื่อไล่ threshold ไป Precision ลดลงตามที่ Recall เพิ่ม ซึ่งเป็น trade‑off ปกติ

**รูปที่ 4. Precision vs Top‑K% (จุดปฏิบัติการ = Top‑5%)**  
![](/mnt/data/434f2c2f-adf1-435f-ae12-7f7bdc7a21c5.png)
ใช้เพื่อเลือก **สัดส่วนลูกค้าที่จะติดต่อ (K%)** ให้เหมาะกับงบประมาณ/กำลังการขาย  
ที่ **5%** โมเดลให้ **Precision ≈ 50%** ⇒ ประโยชน์คือ **ลดปริมาณการติดต่อ 95%** เมื่อเทียบกับการติดต่อทั้งฐาน แต่ยังคงคาดการณ์โอกาสตอบรับได้ครึ่งหนึ่ง

**รูปที่ 5. ไดอะแกรมความเชื่อมั่น (Calibration) — ECE บนกราฟ ≈ 0.033**  
![](/mnt/data/0beaa3eb-4f9e-4e3c-a356-81f6475d7de6.png)
จุดสีน้ำเงินควรอยู่ใกล้เส้น 45° หากคาลิเบรตดี ค่านี้คำนวณแบบ coarse‑bin จึงแตกต่างจากในตาราง (ECE=0.020 คำนวณ 50 บิน) **แต่ยังอยู่ระดับใกล้เคียง** → แนะนำเฝ้าระวังและรีคาลิเบรตเมื่อมี drift

**รูปที่ 6. การกระจายคะแนนตามผลลัพธ์จริง + เกณฑ์ Top‑5%**  
![](/mnt/data/29d80cd3-72ab-4111-a842-5f642fa07287.png)
ฮิสโตแกรมแยก **กลุ่มซื้อ/ไม่ซื้อ** เห็นการแยกช่องคะแนนพอสมควร เส้นตั้งเป็นเกณฑ์ **Top‑5%** ที่ใช้คัดลูกค้า

**รูปที่ 7. จำนวนเคสที่จับได้ใน Top‑5%**  
![](/mnt/data/3f2e992f-a864-4e5a-9e82-6ca4df18d00c.png)
ให้ภาพง่าย ๆ ของจำนวนลูกค้าที่คาดว่าจะ “จับได้” เมื่อเลือกติดต่อเพียง 5% แรก เทียบกับที่เหลือทั้งหมด

**รูปที่ 8. Fairness Slice — TPR@Top‑5% แยกตามการศึกษา**  
![](/mnt/data/974c9f69-be0f-4912-8a8a-774e5ea8bde4.png)
ตรวจสอบความเท่าเทียมเบื้องต้น เห็นว่า TPR ต่างกันตามกลุ่มการศึกษา (เช่น กลุ่ม *master_plus* สูงกว่า) ⇒ ควรตั้ง **guardrail** และทำ **bias audit** เพิ่มหากตัวแปรเกี่ยวข้องกับคุณลักษณะอ่อนไหวโดยอ้อม

**รูปที่ 9. PSI Drift (Train OOF vs Validation) — PSI = 2.231**  
![](/mnt/data/3cfdeb7e-0100-48ef-86ce-b2317316de8f.png)
ค่า PSI > 1 บ่งชี้ **การเลื่อนของการกระจายคะแนน** ที่มีนัยสำคัญ ⇒ ต้องมี **แผนเฝ้าระวัง/รีเทรน** สม่ำเสมอ (เช่น รายเดือน)

---

## ผลกระทบเชิงธุรกิจ (สรุป)
- **Top‑K targeting**: เลือกติดต่อเฉพาะลูกค้า **5% แรก** ตามคะแนน ช่วยประหยัดงบ/แรงงาน และคาดว่าจะพบลูกค้าที่สนใจ **~1 ใน 2** รายที่ติดต่อ  
- **ความน่าเชื่อถือของคะแนน**: ECE อยู่ในเกณฑ์ → คะแนนใช้เป็น **probability of response** ได้โดยตรงในการจำลอง ROI  
- **ธรรมาภิบาลโมเดล**: มี **Gate, Calibration, Fairness slice, PSI drift** สนับสนุนการใช้งานในโปรดักชันและการตรวจสอบย้อนหลัง

---

## ข้อเสนอแนะสำหรับรอบถัดไป
1. **ยกระดับโมเดล**: ทดลอง **meta‑stacking** (เช่น XGBoost + LightGBM) และ **dual calibration** (Isotonic + Beta‑logit) เพื่อเพิ่ม PR‑AUC และลด ECE ให้ต่ำกว่า 0.02 อย่างมั่นคง
2. **Optimize Top‑K ทางเศรษฐศาสตร์**: กำหนด K โดยอิง **ต้นทุนต่อการติดต่อ × ปริมาณ** และ **มูลค่าเฉลี่ยต่อการตอบรับ** แทนการยึด 5% คงที่
3. **Monitoring & Retraining**: ตั้งแดชบอร์ดสำหรับ **KPI Gate / PSI / Fairness** และกำหนดทริกเกอร์รีเทรนเมื่อ PSI เกินเกณฑ์หรือ ECE แย่ลง
4. **Data & Feature**: เพิ่มฟีเจอร์พฤติกรรม/ธุรกรรมตามเวลา (rolling stats, recency‑frequency‑monetary), และจัดการความไม่สมดุลด้วย focal loss/weighting หากจำเป็น

